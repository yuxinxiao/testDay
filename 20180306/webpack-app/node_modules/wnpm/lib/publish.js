/**
 * Created by Guang on 2017/5/27.
 */

'use strict';

const path = require('path');
const validate = require('validate-npm-package-name');

module.exports = () => {
  const pkg = require(path.join(process.cwd(), 'package.json'));
  const name = pkg.name;
  const result = validate(name);

  const errors = (result.errors || []).concat(result.warnings || []);

  if (!name.match(/^@wac\//)) {
    // 验证不是@wac/开头
    errors.push('name must be start with a \'@wac\'');
  }

  if (name.includes('_')) {
    // 不能包含下划线
    errors.push('name can no longer contain special characters underscore');
  }

  if (errors.length !== 0) {
    errors.unshift(`'${name}' validate failed`);
    const message = errors.map(r => {
      return 'ERR! ' + r;
    });
    console.log(message.join('\n'));
    process.exit(1);
  }
};